<% meta_title @document.title %>

<% css_assets 'editor' %>
<% js_assets 'editor' %>

<!-- workspace -->

<div class="title_wrap site_wrap wrap horizontal">
  <h1><%= @document.title %></h1>
  <a class="dropdown_button settings_button button" href="#doc_settings_dropdown">Settings</a>
  <ul class="vertical doc_settings_dropdown_index dropdown_index buttons_index index dropdown" id="doc_settings_dropdown">
    <li><a href="/" class="edit_button button">your profile</a></li
   ><li><a href="/" class="edit_button button">logout</a></li>
  </ul>
</div>

<section class="workspace_wrap site_wrap wrap">
  <div class="editor_wrap wrap" id="editor">

    <!-- webdoc -->
    <div class="frame_layer layer" style="overflow: hidden;">
      <div class="pushscroll_layer layer">
        <div id="webdoc" class="webdoc scroll layer">
          <div class="center">
            <div class="center_cell">
              <div id="board-container" class="center_box">
              </div>
            </div>
            <div id="panel_ghost">
              <div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ui elements -->

    <!--div id="webdoc_x_scrollbar" class="x_scrollbar_container">
      <div class="x_scrollbar scrollbar"></div>
    </div>

    <div id="webdoc_y_scrollbar" class="y_scrollbar_container">
      <div id="scrollbar_y" class="y_scrollbar scrollbar"></div>
    </div-->

    <div id="webdoc_loading" class="loading loading_icon layer"></div>

    <!-- panels -->

    <div class="sidebar">
      <section class="sidebar_wrap">
           <h2>Authors</h2>


        <ul class="horizontal author_index index">
        <% @document.editors.each do |editor| %>
          <li>
          <% if editor == current_user %>
            <%= render :partial => "users/thumb", :locals => { :user => editor } %>
          <% else %>
            <%= render :partial => "users/thumb", :locals => { :user => editor, :subscribed => @document.creator.follower?(current_user), :friendship => @document.creator.friend?(current_user)  } %>
          <% end %>
          </li>
        <% end %>
        </ul>
      </section>

      <section class="sidebar_wrap">
         <h2>Currently on this webdoc</h2>

         <ul class="horizontal reader_index index">
           <li><a href="/" class="user_thumb thumb" style="background-image: url('/images/icon_no_thumb_page_640x480.png');">User Name</a></li
          ><li><a href="/" class="user_thumb thumb" style="background-image: url('/images/icon_no_thumb_page_640x480.png');">User Name</a></li
          ><li><a href="/" class="user_thumb thumb" style="background-image: url('/images/icon_no_thumb_page_640x480.png');">User Name</a></li
          ><li><a href="/" class="user_thumb thumb" style="background-image: url('/images/icon_no_thumb_page_640x480.png');">User Name</a></li
          ><li><a href="/" class="user_thumb thumb" style="background-image: url('/images/icon_no_thumb_page_640x480.png');">User Name</a></li
          ><li><a href="/" class="user_thumb thumb" style="background-image: url('/images/icon_no_thumb_page_640x480.png');">User Name</a></li>
         </ul>
  </section>

  <section class="sidebar_wrap">
         <h2>From the same Author</h2>
         <ul class="vertical thumbs_index index">
           <% (0..(@more_author_documents.length - 1)).step(1) do |i| %>
           <li>
             <%= render 'card', :document => @more_author_documents[i]%>
           </li>
           <% end %>
         </ul>
      </section>
    </div>

    <%= render "documents/panels/toolbar_panel" %>
    <%= render "documents/panels/controls_panel" %>
    <%= render "documents/inspectors/document_inspector" %>
    <%= render "documents/panels/discussions_panel" %>
    <%= render "documents/panels/my_content_panel" %>
    <%= render "documents/panels/apps_panel" %>
    <%= render "documents/panels/packages_panel" %>
    <%= render "documents/panels/browse_web_panel" %>
    <%= render "documents/inspectors/document_inspector" %>
    <%#= render :partial => "documents/panels/social_panel" %>
    <%= render "documents/inspectors/page_inspector" %>
    <%= render "documents/panels/pages_panel" %>
    <%= render "documents/panels/inspector_panel" %>
  </div>
</section>

<%= render "relatedcontent", :documents => @related_documents %>

<% content_for :scripts do %>
  <script>
    WebDoc.WidgetManager.videoWidget = new WebDoc.Widget(<%= raw Rails.cache.fetch("widget_json_video") { Medias::Widget.first(:conditions => {:system_name => 'video'}).to_json } %>);

    new WebDoc.Document(<%= raw Rails.cache.fetch("document_#{@document.uuid}") { @document.as_application_json.to_json.gsub('/script','/sscript') } %>);

    WebDoc.DocumentCategoriesManager._documentCategories = WebDoc.ServerManager.createRecords(WebDoc.Category,<%= raw Rails.cache.fetch("categories_json") { Category.all.to_json } %>);
    WebDoc.ThemeManager._defaultTheme = new WebDoc.Theme(<%= raw Rails.cache.fetch("default_theme_json") { Theme.default.to_json } %>);
    WebDoc.Application.main(function() {
      var editor = new WebDoc.PageEditor();
      editor.load("<%= @document.uuid %>", <%= edit_mode? %>);
    });
  </script>
<% end %>
