<div class="content">
  <div class="wrap">
    <%= render :partial => "viewer_list", :locals => { :documents => @featured_documents } %>
    <%= raw( will_paginate(@featured_documents, :container => false) ) %>
  </div>
</div>
<% content_for :scripts do %>
  <%= include_javascripts :page_editor %>
  <%= include_javascripts :explore %>
  <% if !Rails.env.production? %>
    <%= javascript_include_tag APP_CONFIG['shindig_server_base'] + "/js/core:rpc:pubsub:shindig-container.js?c=1&debug=1" %>
  <% end %>
  <% javascript_tag do -%>
    <% @featured_documents.each do |document| %>
      <% # we need to remove </script> in the json otherwise it ends the containg script tag too early %>
      <% # we preload the server cache with document content %>
      <% cached_document = Rails.cache.fetch("#{document.cache_key}_wo_script") { document.to_json(:include => { :pages => { :include => :items} }).gsub(/<\/script>/, "</*script>") } %>
      try {
        WebDoc.ServerManager.cache.store(new WebDoc.Document(<%= raw cached_document.dup %>));
      }
      catch(e) {
        ddd("error in doc ", e);
      }
    <% end %>
  <% end -%>
<% end %>