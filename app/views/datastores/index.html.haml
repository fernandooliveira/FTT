= stylesheet_link_tag 'style.datastore'
%script{:type => "text/javascript"} 
  :plain 
    function confirmDelete(id) {if(confirm('Are you sure you want to delete this record?')){document.location.href='/datastores?delete='+id}}

%h1= 'Datastores'

- @last_doc_uuid = nil
- @last_widget_uuid = nil
- @records.each do |rec|
  - if @last_doc_uuid != rec.item.page.document.uuid
    %div{:class => 'ds-document'}
      = link_to 'Document: ' + rec.item.page.document.title, '/documents/' + rec.item.page.document.uuid, {:target => '_new'}
    - @last_doc_uuid = rec.item.page.document.uuid
  - if @last_widget_uuid != rec.item.uuid
    %div{:class => 'ds-app'}
      = rec.item.uuid.to_s
    - @last_widget_uuid = rec.item.uuid
    %div{:class => 'ds-record'}
      %table
        %tr
        %th{:class => 'ds-td-key'}= 'Key'
        %th{:class => 'ds-td-value'}= 'Value'
        %th{:class => 'ds-td-updated'}= 'Updated at'
  %div{:class => cycle('ds-record ds-record-even', 'ds-record ds-record-odd')}
    %table
      %tr
        %td{:class => 'ds-td-key'}
          = link_to_function '', 'confirmDelete(' + rec.id.to_s + ')', {:class => 'ds-a-delete'}
          = rec.ds_key
        %td{:class => 'ds-td-value'}= rec.ds_value
        %td{:class => 'ds-td-updated'}= rec.updated_at