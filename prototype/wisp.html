<!DOCTYPE html>
<html>
<head>
  
  <style>
    body {
      background: #efefef;
    }
    canvas {
      /*border: 1px solid #dddddd;*/
      margin-bottom: 3em;
      margin-left: 2.4em;
    }
    label {
      display: inline-block;
      width: 6em;
      text-align: right;
    }
    span {
      font-size: 0.8em;
    }
    a:hover {
      color: black;
    }
    a {
      text-decoration: none;
      color: grey;
    }
  </style>
</head>
<body>
  
  <br />
  
  <label>size</label>
  <input id="size" type="range" min="-1" max="1" step="0.02" value="0" /><span id="size_readout">0</span><br />
  
  <label>top lid</label>
  <input id="top" type="range" min="-0.3" max="1" step="0.02" value="0" /><span id="top_readout">0</span><br />
  
  <label>bottom lid</label>
  <input id="bottom" type="range" min="0" max="1.2" step="0.02" value="0" /><span id="bottom_readout">0</span><br />
  
  <label>evil</label>
  <input id="evil" type="range" min="0" max="1" step="0.02" value="0" /><span id="evil_readout">0</span><br />
  
  <br />
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  <a href="#normal">normal</a>
  <a href="#happy">happy</a>
  <a href="#blank">blank</a>
  <a href="#disapproval">disapproval</a>
  <a href="#anger">anger</a>
  
  <script src="../public/javascripts/jquery-1.4.2.js" type="text/javascript"></script>
  <script src="js/wisp.js" type="text/javascript"></script>
  <script type="text/javascript">
    var values = {
          size: 0,
          top: 0,
          bottom: 0,
          evil: 0
        },
        timer;
    
    function drawWisp( options ){
      wisp
      .clear()
      .translate(32, 32)
      .scale(2.2, 2.2)
      .drawBody()
      .translate(60, 36)
      .scale(0.70, 0.70)
      .drawEyes(options);
    }
    
    jQuery(document).ready(function(){
      
      var sizeReadout = jQuery('#size_readout'),
          topReadout = jQuery('#top_readout'),
          bottomReadout = jQuery('#bottom_readout'),
          evilReadout = jQuery('#evil_readout');
      
      jQuery('#size')
      .bind('change', function(e){
        values.size = parseFloat(this.value);
        sizeReadout.html(this.value);
        drawWisp( values );
      });
      
      jQuery('#top')
      .bind('change', function(e){
        values.top = parseFloat(this.value);
        topReadout.html(this.value);
        drawWisp( values );
      });
      
      jQuery('#bottom')
      .bind('change', function(e){
        values.bottom = parseFloat(this.value);
        bottomReadout.html(this.value);
        drawWisp( values );
      });
      
      jQuery('#evil')
      .bind('change', function(e){
        values.evil = parseFloat(this.value);
        evilReadout.html(this.value);
        drawWisp( values );
      });
      
      jQuery('a[href=#normal]')
      .bind('click', function(e){
        blink( expressions.normal );
      });
      
      jQuery('a[href=#happy]')
      .bind('click', function(e){
        blink( expressions.happy );
      });
      
      jQuery('a[href=#blank]')
      .bind('click', function(e){
        blink( expressions.blank );
      });
      
      jQuery('a[href=#disapproval]')
      .bind('click', function(e){
        blink( expressions.disapproval );
      });
      
      jQuery('a[href=#anger]')
      .bind('click', function(e){
        blink( expressions.anger );
      });
      
      function blink( expression ){
        var delay = 10000 + Math.random() * 15000;
        
        var start = {
              size: values.size,
              top: values.top,
              bottom: values.bottom,
              evil: values.evil
            },
            mid = {
              size: - 0.72,
              top: 0.62,
              bottom: 0.14,
              evil: 0
            },
            end = expression || {
              size: values.size,
              top: values.top,
              bottom: values.bottom,
              evil: values.evil
            };
        
        clearTimeout(timer);
        timer = setTimeout(function(){
          blink();
        }, delay);
        
        jQuery(start)
        .animate(mid, {
          duration: 48,
          step: function(x, y){
            if (y.prop === 'bottom') {
              drawWisp(start);
            }
          }
        })
        .animate(end, {
          duration: 100,
          step: function(x, y){
            if (y.prop === 'bottom') {
              drawWisp(start);
            }
          },
          complete: function(){
            
            if (expression) {
              values.size = expression.size;
              jQuery('#size').val( expression.size );
              sizeReadout.html( expression.size );
              values.top = expression.top;
              jQuery('#top').val( expression.top );
              topReadout.html( expression.top );
              values.bottom = expression.bottom;
              jQuery('#bottom').val( expression.bottom );
              bottomReadout.html( expression.bottom );
              values.evil = expression.evil;
              jQuery('#evil').val( expression.evil );
              evilReadout.html( expression.evil );
            }
          }
        });
      }
      
      blink();
      
      var expressions = {
        normal: {
          size:  0,
          top:  0,
          bottom:  0,
          evil:  0
        },
        happy: {
          size:  0.4,
          top:  -0.16,
          bottom:  1.08,
          evil:  0.08
        },
        disapproval: {
          size: 0.24,
          top: 0.2,
          bottom: 0.1,
          evil: 0.8
        },
        anger: {
          size:  0.52,
          top:  0,
          bottom:  0.44,
          evil:  1
        },
        blank: {
          size:  0,
          top: 0.34,
          bottom: 0.42,
          evil: 0
        }
      }
    });
  </script>
</body>
</html> 