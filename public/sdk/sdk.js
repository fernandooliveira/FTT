widget._onLoad=function(a){if(typeof(a)=="undefined"){this.body=document.body}else{this.body=a}document.onkeydown=function(b){widget._handleKeys(b)};document.onkeypress=function(b){widget._handleKeys(b)};this._callListenersForEvent("_load");widget.onLoad();this._callListenersForEvent("load")};widget._onRefresh=function(){if(this.autoRefreshDelay!=0){setTimeout("widget._onRefresh()",this.autoRefreshDelay*1000)}else{this.autoRefreshTimeout=null}this.onRefresh()};widget._onPreferencesChange=function(){this.onPreferencesChange()};widget._onModeChange=function(){this.onModeChange()};widget._onLanguageChange=function(){this.onLanguageChange()};widget._addEventListener=function(b,a){this.eventsListener.push(new Array(b,a))};widget._callListenersForEvent=function(a){for(i=0;i<this.eventsListener.length;i++){if(this.eventsListener[i][0]==a){this.eventsListener[i][1]()}}};widget._handleKeys=function(b){var a=(b)?b:window.event;if(a.type=="keydown"){c=a.keyCode;if(c<16||(c>16&&c<32)||(c>32&&c<41)||c==46){this.onKeyboardAction(c,true)}}else{c=a.charCode;if(c!=0){this.onKeyboardAction(c,false)}}};widget.communication={_init:function(){widget._addEventListener("load",widget.communication._onLoad)},_onLoad:function(){wd_install_message_listener()}};widget.communication._init();widget.datastore={server_url:"/items/",set:function(b,e,d,g){var a=widget.datastore.server_url;a+=widget.uuid+"/datastore_entries";var f=null;if(typeof(g)!="undefined"){f=g}data={"datastore_entries[key]":b,"datastore_entries[value]":e,"datastore_entries[unique_key]":d};uniboard.network.local.postText(a,data,widget.datastore._setCallback,f)},get:function(b,e){var a=widget.datastore.server_url;a+=widget.uuid+"/datastore_entries?key="+b;var d=null;if(typeof(e)!="undefined"){d=e}uniboard.network.local.getJson(a,widget.datastore._getCallback,d)},getExtended:function(b,e){var a=widget.datastore.server_url;a+=widget.uuid+"/datastore_entries?key="+b;var d=null;if(typeof(e)!="undefined"){d=e}uniboard.network.local.getJson(a,widget.datastore._getExtendedCallback,d)},getForCurrentUser:function(b,e){var a=widget.datastore.server_url;a+=widget.uuid+"/datastore_entries/"+b;var d=null;if(typeof(e)!="undefined"){d=e}uniboard.network.local.getJson(a,widget.datastore._getForCurrentUserCallback,d)},remove:function(b,e){var a=widget.datastore.server_url;a+=widget.uuid+"/datastore_entries/"+b;var d=null;if(typeof(e)!="undefined"){d=e}uniboard.network.local.deleteText(a,widget.datastore._removeCallback,d)},removeAll:function(d){var a=widget.datastore.server_url;a+=widget.uuid+"/datastore_entries/";var b=null;if(typeof(d)!="undefined"){b=d}uniboard.network.local.deleteText(a,widget.datastore._removeAllCallback,b)},getAllKeys:function(){var a=widget.datastore.server_url;a+="getAllKeys?widget_uuid="+widget.uuid;var b=null;if(typeof(callback)!="undefined"){b=callback}uniboard.network.local.getJson(a,widget.datastore._getAllKeysCallback,b)},_setCallback:function(b,a,d){if(typeof(d)=="function"){if(a!=null){d(b,a)}else{if(b==""){d(null,null)}else{d(b,null)}}}},_getCallback:function(d,b,e){if(typeof(e)!="function"){return}if(b!=null){e(null,b);return}var a=new Array();if(d){for(i=0;i<d.length;i++){a[i]=d[i].datastore_entry.ds_value}}e(a,null)},_getExtendedCallback:function(d,b,e){if(typeof(e)!="function"){return}if(b!=null){e(null,b);return}var a=new Array();if(d){for(i=0;i<d.length;i++){a[i]={value:d[i].datastore_entry.ds_value,email:null,updated_at:null};if(typeof(d[i].datastore_entry.updated_at)!="undefined"){a[i].email=d[i].datastore_entry.email;a[i].updated_at=d[i].datastore_entry.updated_at}}}e(a,null)},_getForCurrentUserCallback:function(d,b,e){if(typeof(e)!="function"){return}if(b!=null){e(null,b);return}var a=null;if(d){if(d.length>0){a=d[0].datastore_entry.ds_value}}e(a,null)},_removeCallback:function(b,a,d){if(typeof(d)=="function"){if(a!=null){d(b,a)}else{if(b==""){d(null,null)}else{d(b,null)}}}},_removeAllCallback:function(b,a,d){if(typeof(d)=="function"){if(a!=null){d(b,a)}else{if(b==""){d(null,null)}else{d(b,null)}}}},_getAllKeysCallback:function(d,b,e){if(typeof(e)!="function"){return}if(b!=null){e(null,b);return}var a=new Array();for(i=0;i<r.length;i++){a[i]=r[i].ds_key}e(a,null)},computer:{save:function(a,b){localStorage.setItem(a,b)},get:function(a){return localStorage.getItem(a)},remove:function(a){localStorage.removeItem(a)},getAllKeys:function(){var a=new Array();for(i=0;i<localStorage.length;i++){a[i]=localStorage.key(i)}return a}},document:{save:function(a,b){console.log("temp implementation of widget.datastore.document.save !!!");widget.datastore.computer.save(a,b)},get:function(a){console.log("temp implementation of widget.datastore.document.get !!!");return widget.datastore.computer.get(a)},remove:function(a){console.log("temp implementation of widget.datastore.document.remove !!!");widget.datastore.computer.removeItem(a)},getAllKeys:function(){console.log("temp implementation of widget.datastore.document.getAllKeys !!!");return widget.datastore.computer.getAllKeys()}},server:{save:function(a,b){console.log("temp implementation of widget.datastore.server.save !!!");widget.datastore.computer.save(a,b)},get:function(a){console.log("temp implementation of widget.datastore.server.get !!!");return widget.datastore.computer.get(a)},remove:function(a){console.log("temp implementation of widget.datastore.server.remove !!!");widget.datastore.computer.removeItem(a)},getAllKeys:function(){console.log("temp implementation of widget.datastore.server.getAllKeys !!!");return widget.datastore.computer.getAllKeys()}}};function wd_log(a){if(typeof(console)!="undefined"){console.log(a)}}function wd_build_communication_message(b,d){var a={};a.methodName=b;a.parameters=d;return a}function wd_install_message_listener(){window.addEventListener("message",function(b){var a=json_to_object(b.data);if(!wd_check_is_valid_message(a)){return}wd_message_relay(a)},false)}function wd_check_is_valid_message(a){if(typeof(a.methodName)!="string"){wd_log("Communication message is not valid. message.methodName doesn't exist or is not a string.");return false}if(typeof(a.parameters)!="array"){wd_log("Communication message is not valid. message.parameters doesn't exist or is not an array.");return false}}function wd_message_relay(){var func=message.methodName+"(";for(i=0;i<message.parameters.length;i++){if(i!=0){func+=","}var s=typeof(message.parameters[i])=="string"?true:false;if(s){func+="'"}func+=message.parameters[i];if(s){func+="'"}}func+=")";eval(func)}function object_to_json(a){JSONstring.compactOutput=true;JSONstring.includeProtos=false;JSONstring.includeFunctions=false;JSONstring.detectCirculars=true;JSONstring.restoreCirculars=true;return JSONstring.make(a)}function JSON_to_text(a){console.log("deprecated. Need to be replaced by object_to_json");return object_to_json(a)}function json_to_object(a){return JSONstring.toObject(a)}function text_to_JSON(a){console.log("deprecated. Need to be replaced by json_to_object");return json_to_object(a)}function readFileHttp(g,f,e,a){xmlhttp=getXmlHttp();if(xmlhttp==null){loadDefault();return}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(e==null||e==false){f(xmlhttp.responseXML)}else{f(xmlhttp.responseText)}}};if(a==null||a==true){xmlhttp.open("GET",g,true);xmlhttp.send(null)}else{xmlhttp.open("GET",g,false);var d=setTimeout(function(){xmlhttp.abort()},1000);try{xmlhttp.send(null)}catch(b){}clearTimeout(d);f(xmlhttp.responseText)}}function getXmlHttp(){if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{if(window.ActiveXObject){xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}}if(xmlhttp==null){alert("Your browser does not support XMLHTTP.")}return xmlhttp}widget.internationalization={getLocalizedString:function(d,a){if(typeof(localizedStrings)!="undefined"&&localizedStrings!=null){var b=localizedStrings[d];if(typeof(b)!="undefined"){return b}}if(typeof(a)!="undefined"){return a}return d},setLanguage:function(a){widget.lang=a;widget.internationalization._loadLocaleScript()},_init:function(){widget._addEventListener("_load",widget.internationalization._onLoad)},_onLoad:function(){widget.internationalization._loadLocaleScript()},_loadLocaleScript:function(){var a=document.getElementById("language_script");if(a){document.getElementsByTagName("head")[0].removeChild(a)}var b=document.createElement("script");b.src="Locales/"+widget.lang+"/localizedStrings.js";b.id="language_script";b.type="text/javascript";b.onload=function(){widget._onLanguageChange()};document.getElementsByTagName("head")[0].appendChild(b)}};widget.internationalization._init();function _(b,a){return widget.internationalization.getLocalizedString(b,a)}widget.messages={sendMessage:function(a,b){alert("widget.messages.sendMessage not implemented yet.")},subscribeToTopic:function(b,a){alert("widget.messages.subscribeToTopic not implemented yet.")},unsubscribeOfTopic:function(a){alert("widget.messages.unsubscribeOfTopic not implemented yet.")}};widget.network={getUrl:function(a,d,b){uniboard.network.getUrl(a,d,b)}};widget.preferences={viewContent:"",getValue:function(b,a){return uniboard.preference(b,a)},setValue:function(a,b){uniboard.setPreference(a,b)},_init:function(){},_onLoad:function(){var a=document.createElement("div");a.style.position="absolute";a.style.top=0;a.style.right=0;a.innerHTML='<a href="javascript:widget.preferences._renderEditPane();">[Edit]</a>';widget.body.appendChild(a)},_renderEditPane:function(){this.viewContent=widget.body.innerHTML;var b;var a=new Array();a[0]=new Array("key1","value 1",false);a[1]=new Array("key2","value 2",true);b="EDIT PREFERENCES<br><br><table>";for(i=0;i<a.length;i++){b+="<tr><td>"+a[i][0]+" : </td><td>";if(!a[i][2]){b+='<input type="textbox" id="pref_'+a[i][0]+'" value="';var d=this.getValue(a[i][0]);if(typeof(d)=="undefined"||d==""){b+=a[i][1]}else{b+=d}b+='" />'}else{b+=a[i][1]}b+="</td></tr>"}b+='</table><br><input type="button" value="Cancel" onclick="javascript:widget.preferences._closePreferences();" /> <input type="button" value="Save" onclick="javascript:widget.preferences._saveAndClosePreferences();" />';widget.body.innerHTML=b},_saveAndClosePreferences:function(){var b=new Array();b[0]=new Array("key1","value 1",false);b[1]=new Array("key2","value 2",true);for(i=0;i<b.length;i++){var a=document.getElementById("pref_"+b[i][0]);if(!b[i][2]&&a){this.setValue(b[i][0],a.value)}}this.onPreferencesChange();this._closePreferences();widget._onRefresh()},_closePreferences:function(){widget.body.innerHTML=this.viewContent;widget._onRefresh()}};widget.preferences._init();JSONstring={compactOutput:false,includeProtos:false,includeFunctions:false,detectCirculars:true,restoreCirculars:true,make:function(a,b){this.restore=b;this.mem=[];this.pathMem=[];return this.toJsonStringArray(a).join("")},toObject:function(x){if(!this.cleaner){try{this.cleaner=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(a){this.cleaner=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}}if(!this.cleaner.test(x)){return{}}eval("this.myObj="+x);if(!this.restoreCirculars||!alert){return this.myObj}if(this.includeFunctions){var x=this.myObj;for(var i in x){if(typeof x[i]=="string"&&!x[i].indexOf("JSONincludedFunc:")){x[i]=x[i].substring(17);eval("x[i]="+x[i])}}}this.restoreCode=[];this.make(this.myObj,true);var r=this.restoreCode.join(";")+";";eval('r=r.replace(/\\W([0-9]{1,})(\\W)/g,"[$1]$2").replace(/\\.\\;/g,";")');eval(r);return this.myObj},toJsonStringArray:function(k,e){if(!e){this.path=[]}e=e||[];var j;switch(typeof k){case"object":this.lastObj=k;if(this.detectCirculars){var d=this.mem;var b=this.pathMem;for(var f=0;f<d.length;f++){if(k===d[f]){e.push('"JSONcircRef:'+b[f]+'"');return e}}d.push(k);b.push(this.path.join("."))}if(k){if(k.constructor==Array){e.push("[");for(var f=0;f<k.length;++f){this.path.push(f);if(f>0){e.push(",\n")}this.toJsonStringArray(k[f],e);this.path.pop()}e.push("]");return e}else{if(typeof k.toString!="undefined"){e.push("{");var g=true;for(var f in k){if(!this.includeProtos&&k[f]===k.constructor.prototype[f]){continue}this.path.push(f);var l=e.length;if(!g){e.push(this.compactOutput?",":",\n")}this.toJsonStringArray(f,e);e.push(":");this.toJsonStringArray(k[f],e);if(e[e.length-1]==j){e.splice(l,e.length-l)}else{g=false}this.path.pop()}e.push("}");return e}}return e}e.push("null");return e;case"unknown":case"undefined":case"function":if(!this.includeFunctions){e.push(j);return e}k="JSONincludedFunc:"+k;e.push('"');var h=["\n","\\n","\r","\\r",'"','\\"'];k+="";for(var f=0;f<6;f+=2){k=k.split(h[f]).join(h[f+1])}e.push(k);e.push('"');return e;case"string":if(this.restore&&k.indexOf("JSONcircRef:")==0){this.restoreCode.push("this.myObj."+this.path.join(".")+"="+k.split("JSONcircRef:").join("this.myObj."))}e.push('"');var h=["\n","\\n","\r","\\r",'"','\\"'];k+="";for(var f=0;f<6;f+=2){k=k.split(h[f]).join(h[f+1])}e.push(k);e.push('"');return e;default:e.push(String(k));return e}}};